"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{9576:(e,s,t)=>{t.d(s,{A:()=>i,AuthProvider:()=>n});var a=t(5155),l=t(2115);let r=(0,l.createContext)(void 0);function n(e){let{children:s}=e,[t,n]=(0,l.useState)(null),[i,c]=(0,l.useState)(!1),[o,d]=(0,l.useState)(null),[x,h]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null),[f,b]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=localStorage.getItem("user");e&&n(JSON.parse(e))},[]);let g=async(e,s)=>{c(!0),d(null);try{await new Promise(e=>setTimeout(e,1e3));let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),a=await t.json();if(!a.success)throw Error(a.error||"Erreur de connexion");n(a.user),localStorage.setItem("user",JSON.stringify(a.user)),h(!0);let l=Date.now();b(l),m&&clearTimeout(m);let r=setTimeout(()=>{h(!1),u(null),b(null)},4e3);u(r)}catch(e){d(e instanceof Error?e.message:"Une erreur est survenue")}finally{c(!1)}},j=async()=>{try{console.log("Initialisation d\xe9plac\xe9e c\xf4t\xe9 serveur")}catch(e){console.error("Erreur d'initialisation de la DB:",e)}};return(0,a.jsx)(r.Provider,{value:{user:t,login:g,logout:()=>{n(null),localStorage.removeItem("user"),h(!1),b(null),m&&(clearTimeout(m),u(null))},isLoading:i,error:o,showWelcome:x,hideWelcome:()=>{h(!1),b(null),m&&(clearTimeout(m),u(null))},welcomeStartTime:f,initializeDatabase:j},children:s})}function i(){let e=(0,l.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9824:(e,s,t)=>{t.d(s,{A:()=>q});var a=t(5155),l=t(2115),r=t(6874),n=t.n(r),i=t(5695),c=t(3783),o=t(7580),d=t(8136),x=t(381),h=t(1007),m=t(3562),u=t(3846),f=t(5040),b=t(7434),g=t(6785),j=t(7949),N=t(2355),p=t(3052);let v=[{icon:c.A,label:"Administration",href:"/dashboard"},{icon:o.A,label:"Utilisateurs",href:"/classes"},{icon:d.A,label:"Organigramme",href:"/organization"},{icon:x.A,label:"Configuration",href:"/settings"},{icon:h.A,label:"Profil",href:"/profile"}],y=[{icon:c.A,label:"Accueil",href:"/dashboard"},{icon:m.A,label:"Calendrier",href:"/calendar"},{icon:u.A,label:"Devoirs",href:"/devoirs"},{icon:f.A,label:"Notes",href:"/notes"},{icon:b.A,label:"Bulletin",href:"/bulletin"},{icon:o.A,label:"Ma classe",href:"/classes"},{icon:h.A,label:"Mon profil",href:"/profile"},{icon:x.A,label:"Param\xe8tres",href:"/settings"}],w=[{icon:c.A,label:"Tableau de bord",href:"/dashboard"},{icon:m.A,label:"Calendrier",href:"/calendar"},{icon:u.A,label:"T\xe2ches",href:"/devoirs"},{icon:f.A,label:"Notes",href:"/notes"},{icon:g.A,label:"Projets",href:"/projects"},{icon:h.A,label:"Profil",href:"/profile"},{icon:x.A,label:"Param\xe8tres",href:"/settings"}];function A(e){let{userRole:s,isCollapsed:t,onToggle:r}=e,c=(0,i.usePathname)(),[o,d]=(0,l.useState)(c),[x,h]=(0,l.useState)(null);return(0,l.useEffect)(()=>{d(c),h(null)},[c]),(0,a.jsxs)("aside",{className:"bg-white h-full transition-all duration-300 ".concat(t?"w-16":"w-64"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[t?(0,a.jsx)("div",{className:"flex justify-center w-full",children:(0,a.jsx)(j.A,{className:"h-8 w-8 text-blue-600"})}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MySchedule"})]}),!t&&(0,a.jsx)("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(N.A,{className:"h-5 w-5 text-gray-500"})})]}),t&&(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("button",{onClick:r,className:"w-full p-2 rounded-lg hover:bg-gray-100 transition-colors flex justify-center",title:"D\xe9velopper la navigation",children:(0,a.jsx)(p.A,{className:"h-5 w-5 text-gray-500"})})}),(0,a.jsx)("nav",{className:"".concat(t?"p-2":"p-4"," ").concat(t?"space-y-2":"space-y-3"),children:("admin"===s?v:"personal"===s?w:y).map(e=>{let s=e.icon,l=x===e.href||null===x&&(o===e.href||o.startsWith(e.href)&&"/"!==e.href||"/dashboard"===e.href&&"/"===o);return(0,a.jsxs)(n(),{href:e.href,onClick:()=>{h(e.href)},className:"flex items-center rounded-lg transition-all duration-300 ease-out group relative ".concat(t?"justify-center p-3":"space-x-3 px-4 py-3"," ").concat(l?"bg-blue-600 text-white font-semibold":"text-gray-700 hover:bg-blue-50 hover:text-blue-600"),title:t?e.label:"",children:[(0,a.jsx)(s,{className:"".concat(t?"h-5 w-5":"h-4 w-4"," transition-all duration-300 ").concat(l?"text-white":"text-gray-500 group-hover:text-blue-500")}),!t&&(0,a.jsx)("span",{className:"text-sm transition-all duration-300 ".concat(l?"font-semibold text-white":"font-medium group-hover:text-blue-600"),children:e.label}),t&&(0,a.jsx)("div",{className:"absolute left-14 bg-gray-900 text-white text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap pointer-events-none",children:e.label})]},e.href)})})]})}let C=[{icon:c.A,label:"Admin",href:"/dashboard"},{icon:o.A,label:"Classes",href:"/classes"},{icon:d.A,label:"\xc9cole",href:"/organization"},{icon:x.A,label:"Config",href:"/settings"},{icon:h.A,label:"Profil",href:"/profile"}],S=[{icon:c.A,label:"Accueil",href:"/dashboard"},{icon:m.A,label:"Calendrier",href:"/calendar"},{icon:u.A,label:"Devoirs",href:"/devoirs"},{icon:f.A,label:"Notes",href:"/notes"},{icon:b.A,label:"Bulletin",href:"/bulletin"},{icon:o.A,label:"Classe",href:"/classes"}],k=[{icon:c.A,label:"Tableau",href:"/dashboard"},{icon:m.A,label:"Calendrier",href:"/calendar"},{icon:u.A,label:"T\xe2ches",href:"/devoirs"},{icon:f.A,label:"Notes",href:"/notes"},{icon:g.A,label:"Projets",href:"/projects"},{icon:x.A,label:"Config",href:"/settings"}];function E(e){let{userRole:s}=e,t=(0,i.usePathname)(),l="admin"===s?C:"personal"===s?k:S;return(0,a.jsxs)("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 safe-area-pb",children:[(0,a.jsx)("div",{className:"overflow-x-auto scrollbar-hide",children:(0,a.jsx)("div",{className:"flex items-center px-4 py-2 min-w-max",children:l.map(e=>{let s,l=e.icon,r=t===(s=e.href)||t.startsWith(s)&&"/"!==s||"/dashboard"===s&&"/"===t;return(0,a.jsxs)(n(),{href:e.href,className:"flex flex-col items-center justify-center p-3 rounded-lg min-w-0 transition-colors mx-1 ".concat(r?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600 hover:bg-blue-50"),style:{minWidth:"80px"},children:[(0,a.jsx)(l,{className:"h-6 w-6 mb-1 ".concat(r?"text-blue-600":"text-gray-500")}),(0,a.jsx)("span",{className:"text-xs font-medium text-center leading-tight ".concat(r?"text-blue-600":"text-gray-600"),children:e.label})]},e.href)})})}),(0,a.jsx)("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:(0,a.jsx)("div",{className:"flex space-x-1",children:l.map((e,s)=>(0,a.jsx)("div",{className:"w-1 h-1 bg-gray-300 rounded-full opacity-50"},"indicator-".concat(s)))})})]})}var P=t(646),T=t(5339),M=t(1284),z=t(3861),I=t(4416),B=t(7924),O=t(4835),D=t(6766),L=t(7340);function J(){let e=(0,i.usePathname)(),s={"/":"Tableau de bord","/dashboard":"Tableau de bord","/classes":"Ma classe","/devoirs":"Mes devoirs","/planning":"Mon emploi du temps","/calendar":"Calendrier","/profile":"Mon profil","/settings":"Param\xe8tres","/organization":"Organisation","/bulletin":"Bulletin","/debug":"Debug"},t=(()=>{let t=e.split("/").filter(Boolean),a=[];a.push({label:"Accueil",href:"/",isActive:"/"===e});let l="";return t.forEach((e,r)=>{l+="/".concat(e);let n=r===t.length-1;a.push({label:s[l]||e.charAt(0).toUpperCase()+e.slice(1),href:l,isActive:n})}),a})();return t.length<=1?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Accueil"})]}):(0,a.jsxs)("nav",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-gray-400"}),t.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[s>0&&(0,a.jsx)(p.A,{className:"h-4 w-4 text-gray-400"}),e.isActive?(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.label}):(0,a.jsx)(n(),{href:e.href,className:"text-gray-600 hover:text-gray-900 transition-colors hover:underline",children:e.label})]},e.href))]})}let R=[];function W(e){let{user:s,onLogout:t,isMobile:r=!1}=e,[n,i]=(0,l.useState)(!1),c=(0,l.useRef)(null),o=R.filter(e=>!e.read).length;(0,l.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&i(!1)};return n&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&i(!1)};return n&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[n]);let d=e=>{switch(e){case"success":return(0,a.jsx)(P.A,{className:"h-4 w-4 text-green-500"});case"warning":return(0,a.jsx)(T.A,{className:"h-4 w-4 text-orange-500"});default:return(0,a.jsx)(M.A,{className:"h-4 w-4 text-blue-500"})}};return r?(0,a.jsx)("header",{className:"bg-white border-b border-gray-200 px-4 py-3 w-full",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-sm font-bold",children:"M"})}),(0,a.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"MySchedule"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"relative",ref:c,children:[(0,a.jsxs)("button",{onClick:()=>i(!n),className:"relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,a.jsx)(z.A,{className:"h-5 w-5"}),o>0&&(0,a.jsx)("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 bg-red-500 rounded-full"})]}),n&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-72 bg-white rounded-xl shadow-lg border border-gray-200 z-40 focus:outline-none",tabIndex:-1,autoFocus:!0,children:[(0,a.jsx)("div",{className:"p-3 border-b border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Notifications"}),(0,a.jsx)("button",{onClick:()=>i(!1),className:"p-1 text-gray-400 hover:text-gray-600 rounded-lg",children:(0,a.jsx)(I.A,{className:"h-4 w-4"})})]})}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto",children:R.length>0?(0,a.jsx)("div",{className:"p-2 space-y-2",children:R.map(e=>(0,a.jsx)("div",{className:"p-2 rounded-lg hover:bg-gray-50 transition-colors ".concat(e.read?"bg-gray-25":"bg-blue-25"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:d(e.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat(e.read?"text-gray-700":"text-gray-900"),children:e.title}),(0,a.jsx)("p",{className:"text-xs mt-0.5 ".concat(e.read?"text-gray-500":"text-gray-600"),children:e.message}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:e.time})]})]})},e.id))}):(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)(z.A,{className:"h-6 w-6 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Aucune notification"})]})})]})]}),s.avatar?(0,a.jsx)(D.default,{src:s.avatar,alt:"".concat(s.firstName," ").concat(s.lastName),width:32,height:32,className:"h-8 w-8 rounded-full object-cover"}):(0,a.jsx)("div",{className:"h-8 w-8 bg-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-white text-sm font-medium",children:[s.firstName[0],s.lastName[0]]})})]})]})}):(0,a.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-4 w-full",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(J,{})}),(0,a.jsx)("div",{className:"max-w-sm mx-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(B.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Rechercher...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-400 bg-white"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",ref:c,children:[(0,a.jsxs)("button",{onClick:()=>i(!n),className:"relative p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,a.jsx)(z.A,{className:"h-4.5 w-4.5"}),o>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 h-2.5 w-2.5 bg-red-500 rounded-full"})]}),n&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 z-40 focus:outline-none",tabIndex:-1,autoFocus:!0,children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),(0,a.jsx)("button",{onClick:()=>i(!1),className:"p-1 text-gray-400 hover:text-gray-600 rounded-lg",children:(0,a.jsx)(I.A,{className:"h-4 w-4"})})]}),o>0&&(0,a.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:[o," nouvelle(s) notification(s)"]})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:R.length>0?(0,a.jsx)("div",{className:"p-3 space-y-4",children:R.map(e=>(0,a.jsx)("div",{className:"p-2.5 rounded-lg hover:bg-gray-50 transition-colors border-l-4 ".concat(e.read?"border-transparent bg-gray-25":"border-blue-400 bg-blue-25"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:d(e.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat(e.read?"text-gray-700":"text-gray-900"),children:e.title}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.time})]}),(0,a.jsx)("p",{className:"text-sm mt-1 ".concat(e.read?"text-gray-500":"text-gray-600"),children:e.message})]})]})},e.id))}):(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)(z.A,{className:"h-8 w-8 text-gray-300 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Aucune notification"})]})}),R.length>0&&(0,a.jsx)("div",{className:"p-3 border-t border-gray-100",children:(0,a.jsx)("button",{className:"w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Marquer tout comme lu"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[s.firstName," ",s.lastName]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:s.role})]}),s.avatar?(0,a.jsx)(D.default,{src:s.avatar,alt:"".concat(s.firstName," ").concat(s.lastName),width:32,height:32,className:"h-8 w-8 rounded-full object-cover"}):(0,a.jsx)("div",{className:"h-8 w-8 bg-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-white text-sm font-medium",children:[s.firstName[0],s.lastName[0]]})}),(0,a.jsx)("button",{onClick:t,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Se d\xe9connecter",children:(0,a.jsx)(O.A,{className:"h-4 w-4"})})]})]})]})})}var _=t(9576);function U(e){let{userRole:s,show:t,onHide:r,startTime:n}=e,[i,c]=(0,l.useState)(0);if((0,l.useEffect)(()=>{if(!n)return;let e=()=>{c(Date.now()-n)};e();let s=setInterval(e,50);return()=>clearInterval(s)},[n]),!t)return null;let o=Math.min(i/4e3*100,100);return(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 animate-slide-in-right",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-4 max-w-sm",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(P.A,{className:"h-6 w-6 text-green-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Connexion r\xe9ussie"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"admin"===s?"Bienvenue dans l'administration !":"personal"===s?"Bienvenue dans votre espace personnel !":"Bienvenue dans votre espace \xe9tudiant !"})]}),(0,a.jsx)("button",{onClick:r,className:"flex-shrink-0 ml-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(I.A,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"mt-3 w-full bg-gray-200 rounded-full h-1",children:(0,a.jsx)("div",{className:"bg-green-500 h-1 rounded-full transition-all duration-75 ease-linear",style:{width:"".concat(o,"%")}})})]})})}function F(){let{user:e,showWelcome:s,hideWelcome:t,welcomeStartTime:l}=(0,_.A)();return e&&s?(0,a.jsx)(U,{userName:e.firstName,userRole:e.role,show:s,onHide:t,startTime:l}):null}let q=(0,l.memo)(function(e){let{user:s,children:t,onLogout:r}=e,[n,i]=(0,l.useState)(()=>{{let e=localStorage.getItem("sidebarCollapsed");return null!==e&&JSON.parse(e)}}),c=(0,l.useCallback)(()=>{let e=!n;i(e),localStorage.setItem("sidebarCollapsed",JSON.stringify(e))},[n]);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:"hidden md:flex",children:[(0,a.jsx)("div",{className:"fixed top-0 left-0 h-full z-30",children:(0,a.jsx)(A,{userRole:s.role,isCollapsed:n,onToggle:c})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col transition-all duration-300 ".concat(n?"ml-16":"ml-64"),children:[(0,a.jsx)(W,{user:s,onLogout:r}),(0,a.jsx)("main",{className:"flex-1 p-6 overflow-y-auto page-animate",children:t}),(0,a.jsx)(F,{})]})]}),(0,a.jsxs)("div",{className:"md:hidden flex flex-col min-h-screen",children:[(0,a.jsx)(W,{user:s,onLogout:r,isMobile:!0}),(0,a.jsx)("main",{className:"flex-1 p-4 pb-20 overflow-y-auto page-animate",children:t}),(0,a.jsx)(E,{userRole:s.role}),(0,a.jsx)(F,{})]})]})})}}]);